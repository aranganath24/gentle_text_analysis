# Getting Started with R Studio

## Load libraries

```{r}
library(tm)
library(tidyverse)
library(wordcloud2)
library(quanteda)
library(tidytext)
```


# Reading in a Text Corpus

```{r}
setwd("/Users/adra7980/Documents/diario_text/2019.11.14-ElDiarioCorpus/adverts")
```

```{r, echo=-1}
setwd("/Users/adra7980/Documents/diario_text/2019.11.14-ElDiarioCorpus/adverts")
# read in diario adverts
diario_files<-list.files(pattern=".txt")
```

```{r, echo=-1}
setwd("/Users/adra7980/Documents/diario_text/2019.11.14-ElDiarioCorpus/adverts")
# Create corpus from diario adverts
diario_adverts_corpus<-Corpus(URISource(diario_files), readerControl = list(reader=readPlain))
```

```{r}
diario_adverts_corpus
```

# Creating a tidy dataframe from a text corpus

```{r}
diario_adverts_tidy<-tidy(diario_adverts_corpus)
```

```{r, echo=F}
tidy_diario_head<-head(diario_adverts_tidy, 25)
```

```{r, eval=F}
diario_adverts_tidy
```

```{r, echo=F}
tidy_diario_head %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```

# Creating a word frequency table

```{r}
spanish_stopwords<-as.data.frame(stopwords("spanish"))
```

```{r, message=F, warning=F}
diario_frequency_table<-diario_adverts_tidy %>% 
                        unnest_tokens(word, text) %>% 
                        count(word, sort=TRUE) %>% 
                        filter(!word %in% stop_words$word) %>% 
                        filter(!word %in% spanish_stopwords$`stopwords("spanish")`)
```

```{r, message=F, warning=F}
diario_frequency_table_numbers<-parse_number(diario_frequency_table$word)
```

```{r}
diario_frequency_table<-cbind(diario_frequency_table, diario_frequency_table_numbers)
```

```{r}
diario_frequency_table<-diario_frequency_table %>% 
                        filter(is.na(diario_frequency_table_numbers))
```

```{r}
diario_frequency_table<-diario_frequency_table %>% 
                        select(-diario_frequency_table_numbers)
```

```{r, echo=F}
diario_frequency_table_head<-head(diario_frequency_table, 50)
```

```{r, eval=F}
diario_frequency_table
```

```{r, echo=F}
diario_frequency_table_head %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```

# Visualizing word frequency data

## Charting word frequencies

### Extracting dataframe of ten most frequent words

```{r}
diario_top_ten<-diario_frequency_table %>% 
                slice_max(n, n=10)
```

```{r, eval=F}
diario_top_ten
```

```{r, echo=F}
diario_top_ten %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```

### Using ggplot2 to make chart of ten most frequent words

```{r}
diario_frequency_graph<-
  ggplot(diario_top_ten, aes(x=reorder(word, n), y=n))+
    geom_bar(stat="identity")+
      coord_flip()+
      xlab("")+
      ylab("Frequency")+
      ggtitle("Ten Most Frequent Words in Diario Advertisements")+
      labs(caption = "Source: El Diario Project")
```

```{r}
diario_frequency_graph
```

## Creating a word cloud

```{r}
# make word cloud
wordcloud2(data = df_word_frequencies, minRotation = 0, maxRotation = 0, ellipticity = 0.2)
```

# Extracting bigrams

```{r, eval=F}
diario_adverts_tidy
```

```{r, echo=F}
tidy_diario_head %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```
\

```{r}
diario_bigram<-diario_adverts_tidy %>% 
                  unnest_tokens(bigram, text, token="ngrams", n=2) %>% 
                  count(bigram, sort=TRUE)
```

```{r, echo=F}
diario_bigram_head<-head(diario_bigram, 25)
```

```{r, eval=F}
diario_bigram
```

```{r, echo=F}
diario_bigram_head %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```
\

```{r, warning=F, message=F}
diario_bigram_separated<-diario_bigram %>% 
                          separate(bigram, c("word1", "word2", sep=" "))
```


```{r}
diario_bigram_filtered<-diario_bigram_separated %>% 
                            filter(!word1 %in% stop_words$word) %>%
                            filter(!word2 %in% stop_words$word)
```

remove numbers

```{r, message=F, warning=F}
diario_bigram_word1numbers<-parse_number(diario_bigram_filtered$word1)
```

```{r, message=F, warning=F}
diario_bigram_word2numbers<-parse_number(diario_bigram_filtered$word2)
```


```{r}
diario_bigram_filtered<-cbind(diario_bigram_filtered, diario_bigram_word1numbers, diario_bigram_word2numbers)
```


```{r}
diario_bigram_filtered<-diario_bigram_filtered %>% 
                          filter(is.na(diario_bigram_word1numbers)) %>% 
                          filter(is.na(diario_bigram_word2numbers))
```

```{r}
diario_bigram_filtered_unite<-diario_bigram_filtered %>% 
                                unite(bigram, word1, word2, sep=" ")
```

```{r, echo=F}
diario_bigram_filtered_unite_head<-head(diario_bigram_filtered_unite, 50)
```

```{r, eval=F}
diario_bigram_filtered_unite
```


```{r, echo=F}
diario_bigram_filtered_unite_head %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```
\

```{r}
diario_bigram_filtered_unite<-diario_bigram_filtered_unite %>% 
                              select(-c(diario_bigram_word1numbers, diario_bigram_word2numbers))
```

```{r, eval=F}
diario_bigram_filtered_unite
```

```{r, echo=F}
diario_bigram_filtered_unite_head2<-head(diario_bigram_filtered_unite, 50)
```

```{r, echo=F}
diario_bigram_filtered_unite_head2 %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```


# Visualizing bigrams

```{r}
diario_bigram_top_ten<-diario_bigram_filtered_unite %>% 
                        slice_max(n, n=10)
```

```{r, eval=F}
diario_bigram_top_ten
```

```{r, echo=F}
diario_bigram_top_ten %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```
\

```{r}
bigram_graph<-
  ggplot(diario_bigram_top_ten, aes(x=reorder(bigram, n), y=n))+
    geom_bar(stat="identity")+
      coord_flip()+
      xlab("")+
      ylab("Frequency")+
      ggtitle("Ten Most Frequent Co-Occuring Words in Diario Advertisements")+
      labs(caption = "Source: El Diario Project")
```


```{r}
bigram_graph
```

# Extracting keywords in context

```{r}
kwic_token<-tokens(tidy_diario$text)
```

```{r}
business_keyword_context<-kwic(kwic_token, pattern="business", valuetype="fixed", window=3)
```

```{r, eval=F}
business_keyword_context
```

```{r, echo=F}
business_keyword_context %>% datatable(extensions=c("Scroller", "FixedColumns"), options = list(
  deferRender = TRUE,
  scrollY = 350,
  scrollX = 350,
  dom = "t",
  scroller = TRUE,
  fixedColumns = list(leftColumns = 1)
))
```


https://search.r-project.org/CRAN/refmans/quanteda/html/kwic.html


